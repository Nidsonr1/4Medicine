<div class="modal">
  <form
    nz-form
    nzLayout="vertical"
    [formGroup]="validateFormNewAppointment"
    class="modal-form"
  >
    <p>Preencha os campos abaixo atentamente:</p>

    <div class="modal-form-title">
      <nz-form-item>
        <nz-form-label nzFor="title" nzRequired
          >Título da consulta
        </nz-form-label>
        <nz-form-control nzHasFeedback>
          <input
            nz-input
            type="text"
            id="title"
            formControlName="title"
            placeholder="Título da consulta"
          />
        </nz-form-control>
      </nz-form-item>
    </div>

    <div class="modal-form-description">
      <nz-form-item>
        <nz-form-label nzFor="description" nzRequired
          >Descrição da consulta
        </nz-form-label>
        <nz-form-control nzHasFeedback>
          <textarea
            nz-input
            type="text"
            id="description"
            formControlName="description"
            placeholder="Descrição da consulta"
          ></textarea>
        </nz-form-control>
      </nz-form-item>
    </div>

    <div class="modal-form-date-and-hour">
      <nz-form-item>
        <div class="input-with-info">
          <nz-form-label nzFor="dateAndHour" nzRequired>
            Data e hora:
          </nz-form-label>
          <span
            nz-icon
            nzType="info-circle"
            nzTheme="twotone"
            nz-tooltip
            nzTooltipTitle="Informe a data e hora, inicial e final, do agendamento da consulta, ou uma estimativa de duração da mesma."
          ></span>
        </div>

        <nz-form-control nzHasFeedback>
          <nz-range-picker
            id="dateAndHour"
            formControlName="dateAndHour"
            nzFormat="dd/MM/yyyy HH:mm"
            [nzDisabledDate]="disabledDate"
            [nzShowTime]="{
              nzFormat: 'HH:mm',
              nzHourStep: 1,
              nzMinuteStep: 10,
              nzDefaultOpenValue: timeDefaultValue
            }"
          ></nz-range-picker>
        </nz-form-control>
      </nz-form-item>
    </div>

    <div class="modal-form-patient">
      <div class="modal-form-patient-search">
        <div class="modal-form-patient-search-label">
          <p><span></span> Quem é seu paciente?</p>
          <div class="feedback">
            <span
              *ngIf="validateFormNewAppointment.value.patientId"
              class="feedback-icon-sucess"
              nz-icon
              nzType="check-circle"
              nzTheme="fill"
            ></span>
            <span
              *ngIf="
                !validateFormNewAppointment.value.patientId && resultPatients
              "
              class="feedback-icon-error"
              nz-icon
              nzType="close-circle"
              nzTheme="fill"
            ></span>
          </div>
        </div>

        <div class="modal-form-patient-search-input">
          <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton">
            <input
              nz-input
              type="text"
              id="patientName"
              formControlName="patientName"
              placeholder="Informe o nome do paciente"
              [(ngModel)]="validateFormNewAppointment.value.patientName"
            />
          </nz-input-group>
          <ng-template #suffixIconButton>
            <button
              nz-button
              nzType="primary"
              nzSearch
              [disabled]="!validateFormNewAppointment.value.patientName"
              (click)="
                searchPatients(validateFormNewAppointment.value.patientName)
              "
            >
              <span nz-icon nzType="search"></span>
            </button>
          </ng-template>
        </div>
      </div>

      <div class="modal-form-patient-result" *ngIf="resultPatients">
        <div
          *ngIf="resultPatients.length"
          class="modal-form-patient-result-with-data"
        >
          <nz-alert
            nzShowIcon
            nzType="warning"
            nzMessage="Atenção no CPF para pacientes com o mesmo nome!"
            nzCloseable
          ></nz-alert>

          <nz-form-item>
            <nz-radio-group id="patientId" formControlName="patientId">
              <label
                nz-radio
                [nzValue]="patient.id"
                *ngFor="let patient of resultPatients"
              >
                {{ patient.name }} - <b>{{ patient.cpf }}</b></label
              >
            </nz-radio-group>
          </nz-form-item>
        </div>

        <div
          *ngIf="!resultPatients.length"
          class="modal-form-patient-result-without-data"
        >
          <span nz-icon nzType="robot" nzTheme="outline"></span>
          <p>Esse usuário não existe</p>
        </div>
      </div>
    </div>

    <div class="modal-form-call">
      <nz-form-item>
        <nz-form-label nzFor="haveCall">
          A consulta será online?
        </nz-form-label>

        <nz-form-control>
          <div class="modal-form-call-link">
            <nz-radio-group id="haveCall" formControlName="haveCall">
              <label nz-radio [nzValue]="true">Sim</label>
              <label nz-radio [nzValue]="false">Não</label>
            </nz-radio-group>

            <nz-input-group
              *ngIf="validateFormNewAppointment.controls['haveCall'].value"
              nzAddOnAfterIcon="video-camera-add"
            >
              <input
                nz-input
                id="linkCall"
                formControlName="linkCall"
                type="text"
              />
            </nz-input-group>
          </div>
        </nz-form-control>
      </nz-form-item>
    </div>

    <div class="modal-form-footer">
      <button nz-button nzType="default" (click)="closeModal()">
        Cancelar
      </button>
      <button
        nz-button
        nzType="primary"
        (click)="createNewAppointment()"
        [disabled]="!validateFormNewAppointment.valid"
      >
        Agendar
      </button>
    </div>
  </form>
</div>
